{"version":3,"sources":["../../../../src/api/purchase/confirm/index.js"],"names":["config","db","api","post","req","res","status","send","end","STATUS_UNAUTHORIZED","STATUS_SERVER_ERROR","then","authData","body","addressData","toString","apiRes","servicesSum","servicesData","services","reduce","total","current","value","amount","deliveryTax","estimatedCost","transactionOperationTax","totalPurchase","calculedValue","json","catch","err","message","console","log","object","data"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;AACA;;;;;;kBAEe,gBAAoB;AAAA,MAAjBA,MAAiB,QAAjBA,MAAiB;AAAA,MAATC,EAAS,QAATA,EAAS;;AAClC,MAAIC,MAAM,sBAAV;;AAEA;AACAA,MAAIC,IAAJ,CAAS,GAAT,EAAc,UAACC,GAAD,EAAMC,GAAN,EAAc;;AAEzBA,QAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,gBAArB;AACAF,QAAIG,GAAJ;AACA;AACA,QAAMC,sBAAsB,GAA5B;AACA,QAAMC,sBAAsB,GAA5B;;AAEA,6BAAcC,IAAd,CAAoB,UAACC,QAAD,EAAc;;AAEhC,6BAAgBR,IAAIS,IAAJ,CAASC,WAAzB,EAAsCF,SAASG,QAAT,EAAtC,EACCJ,IADD,CACM,UAACK,MAAD,EAAY;;AAEhB,YAAMC,cAAcb,IAAIS,IAAJ,CAASK,YAAT,CAAsBC,QAAtB,CAA+BC,MAA/B,CAAuC,UAACC,KAAD,EAAQC,OAAR,EAAqB;AAC9E,iBAAOD,QAASC,QAAQC,KAAR,GAAgBD,QAAQE,MAAxC;AACD,SAFmB,EAEjB,CAFiB,CAApB;;AAIA,YAAMC,cAAcT,OAAOU,aAA3B;AACA,YAAMC,0BAA0B,oCAAaV,cAAcQ,WAA3B,CAAhC;AACA,YAAMG,gBAAgBX,cAAcQ,WAAd,GAA4BE,wBAAwBE,aAA1E;;AAEAxB,YAAIyB,IAAJ,CAAS;AACPb,kCADO;AAEPQ,kCAFO;AAGPE,0DAHO;AAIPC;AAJO,SAAT;AAMAvB,YAAIG,GAAJ;AACD,OAlBD,EAmBCuB,KAnBD,CAmBO,UAACC,GAAD,EAAS;AACd3B,YAAIC,MAAJ,CAAWI,mBAAX,EAAgCH,IAAhC,CAAqCyB,IAAIC,OAAzC;AACAC,gBAAQC,GAAR,CAAYH,IAAIC,OAAhB,EAAyBD,IAAII,MAA7B;AACA/B,YAAIG,GAAJ;AACD,OAvBD;AAyBD,KA3BD,EA2BGuB,KA3BH,CA2BU,UAACC,GAAD,EAAS;AACjBE,cAAQC,GAAR,CAAYH,IAAIC,OAAhB,EAAyBD,IAAIK,IAA7B;AACAhC,UAAIC,MAAJ,CAAWG,mBAAX,EAAgCF,IAAhC,CAAqCyB,IAAIC,OAAzC;AACA5B,UAAIG,GAAJ;AACD,KA/BD;AAgCF,GAxCD;;AA0CA,SAAON,GAAP;AACA,C","file":"index.js","sourcesContent":["import { Router } from 'express'\nimport purchaseService from './service'\nimport authService from '../../login/service'\nimport ecommerceTax from '../../taxs/transactionEcommerce'\n\nexport default ({ config, db }) => {\n\tlet api = Router();\n\n\t// perhaps expose some API metadata at the root\n\tapi.post('/', (req, res) => {\n\n    res.status(505).send('I m on confirm')\n    res.end()\n    return \n    const STATUS_UNAUTHORIZED = 401\n    const STATUS_SERVER_ERROR = 500\n\n    authService().then( (authData) => {\n\n      purchaseService(req.body.addressData, authData.toString())\n      .then((apiRes) => {\n\n        const servicesSum = req.body.servicesData.services.reduce( (total, current ) => {\n          return total + (current.value * current.amount) \n        }, 0)\n\n        const deliveryTax = apiRes.estimatedCost\n        const transactionOperationTax = ecommerceTax(servicesSum + deliveryTax)\n        const totalPurchase = servicesSum + deliveryTax + transactionOperationTax.calculedValue\n\n        res.json({\n          servicesSum,\n          deliveryTax,\n          transactionOperationTax,\n          totalPurchase\n        })\n        res.end()\n      })\n      .catch((err) => {\n        res.status(STATUS_SERVER_ERROR).send(err.message)\n        console.log(err.message, err.object)\n        res.end()\n      })\n\n    }).catch( (err) => {\n      console.log(err.message, err.data)\n      res.status(STATUS_UNAUTHORIZED).send(err.message)\n      res.end()\n    })\n\t});\n\n\treturn api;\n}\n"]}